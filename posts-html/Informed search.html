<h1 id="informed-search">Informed search</h1>
<p>See the source code on GitHub: <a href="https://github.com/qsctr/navigate">https://github.com/qsctr/navigate</a></p>
<p>Use the program: <a href="https://qsctr.github.io/navigate">https://qsctr.github.io/navigate</a> (It is recommended to use the latest version of Chrome)</p>
<h2 id="11-3-2016-">11/3/2016:</h2>
<p>The goal of this project is to use uniform cost, greedy, and A* search algorithms to search a graph. But instead of searching a graph of cities in Romania I used the OpenStreetMap Overpass API to query the intersections of any roads near the user&#39;s location, and search the graph of the intersections, similar to a navigation program. However it does not take into account things like traffic lights or one-way roads.</p>
<p>I used TypeScript (and HTML and CSS) for this project. TypeScript is a superset of JavaScript which adds types to the language and compiles to JavaScript.</p>
<p>In the website, after the user selects an area to search, it queries the OpenStreetMap Overpass API to get all the points on all the roads in the area. It then creates a graph by turning the points into nodes and connecting them with each other. After that the user can choose a starting node and a goal node from the map, and also the type of search (uniform cost, greedy, or A*). After the search is finished, the amount of nodes expanded, the path found, and the fringe are shown.</p>
<p>Uniform cost, greedy, and A* searches all work in a similar way. The graph is searched by assigning each node a score and expanding the nodes in order of ascending scores. They are only different in the way the score is calculated for each node. So I wrote a general search function called <code>bestFirstSearch</code>.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">bestFirstSearch</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> GraphNode<span class="token punctuation">,</span> goal<span class="token punctuation">:</span> GraphNode<span class="token punctuation">,</span>
scoreFunc<span class="token punctuation">:</span> ScoringFunction<span class="token punctuation">)</span><span class="token punctuation">:</span> SearchResult <span class="token punctuation">{</span>
    <span class="token keyword">const</span> expanded<span class="token punctuation">:</span> GraphNode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> scores <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span>Id<span class="token punctuation">,</span> Score<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>start<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token function">scoreFunc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        node<span class="token punctuation">:</span> start<span class="token punctuation">,</span>
        parentScore<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        distance<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> parents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span>Id<span class="token punctuation">,</span> GraphNode<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fringe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token operator">&lt;</span>GraphNode<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        comparator<span class="token punctuation">:</span> <span class="token punctuation">(</span>a<span class="token punctuation">:</span> GraphNode<span class="token punctuation">,</span> b<span class="token punctuation">:</span> GraphNode<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> scores<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">-</span> scores<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        initialValues<span class="token punctuation">:</span> <span class="token punctuation">[</span>start<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>fringe<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> current <span class="token operator">=</span> fringe<span class="token punctuation">.</span><span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>expanded<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        expanded<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> currentScore <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span>id<span class="token punctuation">)</span> as Score<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">===</span> goal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span>goal<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> parent <span class="token operator">=</span> goal<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                parent <span class="token operator">=</span> parents<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>id<span class="token punctuation">)</span> as GraphNode<span class="token punctuation">;</span>
                path<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> expanded<span class="token punctuation">,</span> path<span class="token punctuation">,</span> fringe <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> distance<span class="token punctuation">,</span> child <span class="token punctuation">}</span> of current<span class="token punctuation">.</span>connections<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>expanded<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> oldChildScore <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> newChildScore <span class="token operator">=</span> <span class="token function">scoreFunc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                node<span class="token punctuation">:</span> child<span class="token punctuation">,</span>
                parentScore<span class="token punctuation">:</span> currentScore<span class="token punctuation">,</span>
                distance
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldChildScore <span class="token operator">===</span> undefined <span class="token operator">||</span> newChildScore <span class="token operator">&lt;</span> oldChildScore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                scores<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>id<span class="token punctuation">,</span> newChildScore<span class="token punctuation">)</span><span class="token punctuation">;</span>
                parents<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>id<span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
                fringe<span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> expanded <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here are all the interface and type definitions for the types used in the function above.</p>
<pre class="language-typescript"><code class="language-typescript">type Id <span class="token operator">=</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
type Score <span class="token operator">=</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
type Distance <span class="token operator">=</span> <span class="token keyword">number</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">GraphNode</span> <span class="token punctuation">{</span>
    readonly lat<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
    readonly lng<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
    readonly id<span class="token punctuation">:</span> Id<span class="token punctuation">;</span>
    readonly connections<span class="token punctuation">:</span> Connection<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Connection</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// "Adjacency" is too hard to spell</span>
    readonly distance<span class="token punctuation">:</span> Distance<span class="token punctuation">;</span>
    readonly child<span class="token punctuation">:</span> GraphNode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

type ScoringFunction <span class="token operator">=</span> <span class="token punctuation">(</span>info<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">:</span> GraphNode<span class="token punctuation">;</span>
    parentScore<span class="token punctuation">:</span> Score<span class="token punctuation">;</span>
    distance<span class="token punctuation">:</span> Distance<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> Score<span class="token punctuation">;</span>

type SearchFunction <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token punctuation">:</span> GraphNode<span class="token punctuation">,</span> goal<span class="token punctuation">:</span> GraphNode<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> SearchResult<span class="token punctuation">;</span>

type SearchResult <span class="token operator">=</span> <span class="token punctuation">{</span>
    expanded<span class="token punctuation">:</span> GraphNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    path<span class="token operator">?</span><span class="token punctuation">:</span> GraphNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    fringe<span class="token operator">?</span><span class="token punctuation">:</span> PriorityQueue<span class="token operator">&lt;</span>GraphNode<span class="token operator">></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>A priority queue is basically a data structure which is first in, smallest out. So unlike a normal queue, the order you put stuff into it doesn&#39;t matter. TypeScript/JavaScript doesn&#39;t have a built-in priority queue data type, so I used <a href="https://github.com/adamhooper/js-priority-queue/">a library</a>.</p>
<p>I used <code>Map</code>s for keeping track of the scores and parents of nodes instead of mutable properties on the node objects themselves, because I didn&#39;t like the idea of the nodes being mutated after going through a search and having to reset them. <code>Map</code> is a built-in JavaScript data type (since ECMAScript 2015).</p>
<p><code>bestFirstSearch</code> has an argument called <code>scoreFunc</code>, which is the function to call to assign a score to each node.</p>
<p>In uniform cost search, the scoring function for each node is the total distance traveled from the start node to the current one. In other words, it is the sum of the parent score and the distance from the parent, if the score for the starting node is 0.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> uniformCostSearch<span class="token punctuation">:</span> SearchFunction <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> goal<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
    <span class="token function">bestFirstSearch</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> parentScore<span class="token punctuation">,</span> distance <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> parentScore <span class="token operator">+</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>In greedy search, the scoring function for each node is the straight-line distance from that node to the goal node.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> greedySearch<span class="token punctuation">:</span> SearchFunction <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> goal<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
    <span class="token function">bestFirstSearch</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> node <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">distanceBetween</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> goal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>distanceBetween</code> is just the distance formula.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">distanceBetween</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> GraphNode<span class="token punctuation">,</span> b<span class="token punctuation">:</span> GraphNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>lat <span class="token operator">-</span> b<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>lng <span class="token operator">-</span> b<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And A* is a combination of uniform cost and greedy.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> aStarSearch<span class="token punctuation">:</span> SearchFunction <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> goal<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
    <span class="token function">bestFirstSearch</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> node<span class="token punctuation">,</span> parentScore<span class="token punctuation">,</span> distance <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
        parentScore <span class="token operator">+</span> distance <span class="token operator">+</span> <span class="token function">distanceBetween</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> goal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Uniform cost search can find the shortest path. However, it also takes more time than the other searches, since it has to expand a lot of nodes.</p>
<p>Greedy search is less accurate than uniform cost, but it is very fast, because it expands very few nodes.</p>
<p>A* search is in the middle. It is faster than uniform cost, but still quite accurate.</p>
<p>For my project, even though there can sometimes be tens of thousands of nodes in total, searching is still very fast, so uniform cost search is the best option to choose in this case.</p>
