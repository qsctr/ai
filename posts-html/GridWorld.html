<h1 id="gridworld">GridWorld</h1>
<p>See the source code on GitHub: <a href="https://github.com/qsctr/gridworld">https://github.com/qsctr/gridworld</a></p>
<h2 id="9-19-2016-">9/19/2016:</h2>
<p>GridWorld is a simulation where there are walls and agents in a grid. Each agent follows the walls according to certain rules, so they are simple reflex agents. There can also be treasures in the world, and an agent will stop at a treasure if it finds one. I did my project using Haskell and the Gloss graphics library.</p>
<p>Here are the rules for GridWorld. At each step, each agent senses the eight blocks surrounding it in the grid, and whether they are occupied by walls or not. From those eight values, it then determines a &quot;feature vector&quot;, which in this case happens to only have four values. It is determined by going clockwise around the surrounding squares starting from the top one, and combining every two squares into one. The way that they are combined is using the or operation, in other words, if either one is occupied, the feature vector treats both blocks as occupied. Then, the agent decides on its next move based on the feature vector. You can see how it decides in the code below.</p>
<p>Here is how I wrote the rules in my program. I separated them into <code>sense</code>, <code>decide</code>, and <code>act</code> functions.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">type</span> <span class="token constant">SensorInput</span>   <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">Bool</span><span class="token punctuation">]</span>
<span class="token keyword">type</span> <span class="token constant">FeatureVector</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">Bool</span><span class="token punctuation">]</span>
<span class="token keyword">type</span> <span class="token constant">Location</span>      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span>
<span class="token keyword">type</span> <span class="token constant">Action</span>        <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">sense</span> <span class="token operator">::</span> <span class="token constant">SensorInput</span> <span class="token operator">-></span> <span class="token constant">FeatureVector</span>
<span class="token hvariable">sense</span> <span class="token operator">=</span> <span class="token builtin">map</span> <span class="token builtin">or</span><span class="token operator"> . </span><span class="token hvariable">chunksOf</span> <span class="token number">2</span>

<span class="token hvariable">decide</span> <span class="token operator">::</span> <span class="token constant">FeatureVector</span> <span class="token operator">-></span> <span class="token constant">Action</span>
<span class="token hvariable">decide</span> <span class="token punctuation">[</span><span class="token constant">True</span><span class="token punctuation">,</span> <span class="token constant">True</span><span class="token punctuation">,</span> <span class="token constant">True</span><span class="token punctuation">,</span> <span class="token constant">True</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">-- don't move</span>
<span class="token hvariable">decide</span> <span class="token punctuation">[</span><span class="token constant">True</span><span class="token punctuation">,</span> <span class="token constant">False</span><span class="token punctuation">,</span> <span class="token hvariable">_</span><span class="token punctuation">,</span> <span class="token hvariable">_</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">-- east</span>
<span class="token hvariable">decide</span> <span class="token punctuation">[</span><span class="token hvariable">_</span><span class="token punctuation">,</span> <span class="token constant">True</span><span class="token punctuation">,</span> <span class="token constant">False</span><span class="token punctuation">,</span> <span class="token hvariable">_</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">-- south</span>
<span class="token hvariable">decide</span> <span class="token punctuation">[</span><span class="token hvariable">_</span><span class="token punctuation">,</span> <span class="token hvariable">_</span><span class="token punctuation">,</span> <span class="token constant">True</span><span class="token punctuation">,</span> <span class="token constant">False</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">-- west</span>
<span class="token hvariable">decide</span> <span class="token hvariable">_</span>                        <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">-- north</span>

<span class="token hvariable">act</span> <span class="token operator">::</span> <span class="token constant">Location</span> <span class="token operator">-></span> <span class="token constant">Action</span> <span class="token operator">-></span> <span class="token constant">Location</span>
<span class="token hvariable">act</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">y</span> <span class="token operator">+</span> <span class="token hvariable">b</span><span class="token punctuation">)</span>
</code></pre>
<p>The <code>type</code> keywords simply creates a synonym for another type to make the code easier to read. So <code>SensorInput</code> and <code>FeatureVector</code> are both actually just lists of <code>Bool</code>s. (Yes, <code>FeatureVector</code> isn&#39;t a <code>Vector</code>.)</p>
<p>The functions are pretty straightforward and easy to understand, except possibly <code>sense</code>. <code>sense</code> is defined as a composition of the <code>map or</code> function and the <code>chunksOf 2</code> function. Since function composition goes from right to left, the input is first split into chunks of 2 (so it is a list of length-2 lists), then the <code>or</code> function is applied to each element in the list, and you get a list as the output, since the <code>or</code> function takes a list and returns whether any of the values inside are <code>True</code>. For the <code>decide</code> function, the last equation has <code>_</code> as the argument, so by default, for any combination of values in the feature vector not mentioned in the above equations, the agent moves north. For example, if it is in empty space, it keeps moving north until it finds a wall to follow.</p>
<p>As with my previous AI projects, I used a record data structure to store the state of the program. Since Haskell does not allow global state, because if functions rely on the values of global variables then they will not be referentially transparent, I have to pass the state to all functions which rely on some information in the state, so that their output is only determined from their input.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token import_statement"><span class="token keyword">import</span> <span class="token keyword">qualified</span> Data.Set <span class="token keyword">as</span> S</span>
</code></pre>
<pre class="language-haskell"><code class="language-haskell"><span class="token import_statement"><span class="token keyword">import</span> Graphics.Gloss.Data.ViewState</span>
</code></pre>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">type</span> <span class="token constant">Locations</span> <span class="token operator">=</span> <span class="token constant">S.Set</span> <span class="token constant">Location</span>
</code></pre>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Mode</span> <span class="token operator">=</span> <span class="token constant">Viewing</span> <span class="token operator">|</span> <span class="token constant">EditingWalls</span> <span class="token operator">|</span> <span class="token constant">EditingAgents</span> <span class="token operator">|</span> <span class="token constant">EditingTreasures</span> <span class="token keyword">deriving</span> <span class="token punctuation">(</span><span class="token constant">Eq</span><span class="token punctuation">,</span> <span class="token constant">Enum</span><span class="token punctuation">,</span> <span class="token constant">Bounded</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">State</span> <span class="token operator">=</span> <span class="token constant">State</span>
    <span class="token punctuation">{</span> <span class="token hvariable">walls</span>       <span class="token operator">::</span> <span class="token constant">Locations</span>
    <span class="token punctuation">,</span> <span class="token hvariable">agents</span>      <span class="token operator">::</span> <span class="token constant">Locations</span>
    <span class="token punctuation">,</span> <span class="token hvariable">treasures</span>   <span class="token operator">::</span> <span class="token constant">Locations</span>
    <span class="token punctuation">,</span> <span class="token hvariable">playing</span>     <span class="token operator">::</span> <span class="token constant">Bool</span>
    <span class="token punctuation">,</span> <span class="token hvariable">viewState</span>   <span class="token operator">::</span> <span class="token constant">ViewState</span>
    <span class="token punctuation">,</span> <span class="token hvariable">windowW</span>     <span class="token operator">::</span> <span class="token constant">Int</span>
    <span class="token punctuation">,</span> <span class="token hvariable">windowH</span>     <span class="token operator">::</span> <span class="token constant">Int</span>
    <span class="token punctuation">,</span> <span class="token hvariable">mode</span>        <span class="token operator">::</span> <span class="token constant">Mode</span>
    <span class="token punctuation">,</span> <span class="token hvariable">leftButton</span>  <span class="token operator">::</span> <span class="token constant">Bool</span>
    <span class="token punctuation">,</span> <span class="token hvariable">rightButton</span> <span class="token operator">::</span> <span class="token constant">Bool</span> <span class="token punctuation">}</span>
</code></pre>
<p>Like the Game of Life project, instead of using a matrix of values, I used three sets of <code>Location</code>s (I defined <code>Location</code> as a synonym for <code>(Int, Int)</code>) to represent the locations of the different objects in the simulation. This allows the grid to be infinitely large. <code>ViewState</code> is a data type from the <code>Graphics.Gloss.Data.ViewState</code> module which maps input events to viewport changes. And <code>Mode</code> is a data type that I defined which can have four values (see above).</p>
<p>All the other code in the program is for the additional features that I added, such as adding and removing objects, reading from and saving to text files, moving around and zooming the window, fitting the world to the screen, etc.</p>
<p>I think the most challenging functions to write in this program were the <code>parseMap</code>, <code>convertToText</code>, and <code>fitWindow</code> functions.</p>
<p><code>parseMap</code> converts from a text file of a grid into the actual <code>State</code> data structure used by the program. Because I used sets of ordered pairs instead of a matrix to represent the objects in the world, the conversion process was complicated. I decided to stick with using an actual grid as the format for text files, because that would make it easier to edit the file by hand, comparing to editing a bunch of pairs separated by commas. The function also has to identify all the errors in the text file, if there are any, and combine them into a readable string, including the line numbers of each error in the text file.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">parseMap</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-></span> <span class="token constant">Either</span> <span class="token constant">ErrorMessage</span> <span class="token constant">State</span>
<span class="token hvariable">parseMap</span> <span class="token operator">=</span> <span class="token builtin">fmap</span> <span class="token hvariable">toState</span><span class="token operator"> . </span><span class="token hvariable">combine</span><span class="token operator"> . </span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token builtin">foldr</span> <span class="token hvariable">add</span> <span class="token hvariable">start</span><span class="token operator"> . </span><span class="token hvariable">pair</span><span class="token punctuation">)</span><span class="token operator"> . </span><span class="token builtin">zip</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">..</span><span class="token punctuation">]</span><span class="token operator"> . </span><span class="token builtin">lines</span>
    <span class="token keyword">where</span>
        <span class="token hvariable">start</span> <span class="token operator">=</span> <span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">S.empty</span><span class="token punctuation">,</span> <span class="token hvariable">S.empty</span><span class="token punctuation">,</span> <span class="token hvariable">S.empty</span><span class="token punctuation">)</span>
        <span class="token hvariable">pair</span> <span class="token punctuation">(</span><span class="token hvariable">y</span><span class="token punctuation">,</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span> <span class="token hvariable">x</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">xs</span> <span class="token operator">!!</span> <span class="token hvariable">x</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">..</span> <span class="token builtin">length</span> <span class="token hvariable">xs</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token hvariable">add</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">wls</span><span class="token punctuation">,</span> <span class="token hvariable">ags</span><span class="token punctuation">,</span> <span class="token hvariable">trs</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token builtin">toLower</span> <span class="token hvariable">c</span> <span class="token operator">==</span> <span class="token hvariable">wallChar</span>     <span class="token operator">=</span> <span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">S.insert</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token hvariable">wls</span><span class="token punctuation">,</span> <span class="token hvariable">ags</span><span class="token punctuation">,</span> <span class="token hvariable">trs</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token builtin">toLower</span> <span class="token hvariable">c</span> <span class="token operator">==</span> <span class="token hvariable">agentChar</span>    <span class="token operator">=</span> <span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">wls</span><span class="token punctuation">,</span> <span class="token hvariable">S.insert</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token hvariable">ags</span><span class="token punctuation">,</span> <span class="token hvariable">trs</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token builtin">toLower</span> <span class="token hvariable">c</span> <span class="token operator">==</span> <span class="token hvariable">treasureChar</span> <span class="token operator">=</span> <span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">wls</span><span class="token punctuation">,</span> <span class="token hvariable">ags</span><span class="token punctuation">,</span> <span class="token hvariable">S.insert</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token hvariable">trs</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token builtin">toLower</span> <span class="token hvariable">c</span> <span class="token operator">==</span> <span class="token hvariable">emptyChar</span>    <span class="token operator">=</span> <span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">wls</span><span class="token punctuation">,</span> <span class="token hvariable">ags</span><span class="token punctuation">,</span> <span class="token hvariable">trs</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token builtin">otherwise</span>                 <span class="token operator">=</span> <span class="token constant">Left</span> <span class="token operator">$</span>
                <span class="token string">"Illegal character '"</span> <span class="token operator">++</span> <span class="token punctuation">[</span><span class="token hvariable">c</span><span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token string">"' at line "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token hvariable">y</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">++</span> <span class="token string">", col "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token hvariable">add</span> <span class="token hvariable">a</span> <span class="token punctuation">(</span><span class="token constant">Left</span> <span class="token hvariable">msg</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token constant">Left</span> <span class="token hvariable">newMsg</span> <span class="token operator">&lt;-</span> <span class="token hvariable">add</span> <span class="token hvariable">a</span> <span class="token hvariable">start</span> <span class="token operator">=</span> <span class="token constant">Left</span> <span class="token operator">$</span> <span class="token hvariable">msg</span> <span class="token operator">++</span> <span class="token string">"\n"</span> <span class="token operator">++</span> <span class="token hvariable">newMsg</span>
            <span class="token operator">|</span> <span class="token builtin">otherwise</span>                  <span class="token operator">=</span> <span class="token constant">Left</span> <span class="token hvariable">msg</span>
        <span class="token hvariable">combine</span> <span class="token hvariable">xs</span>
            <span class="token operator">|</span> <span class="token builtin">any</span> <span class="token hvariable">isLeft</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token constant">Left</span> <span class="token operator">$</span> <span class="token hvariable">intercalate</span> <span class="token string">"\n"</span> <span class="token operator">$</span> <span class="token hvariable">lefts</span> <span class="token hvariable">xs</span>
            <span class="token operator">|</span> <span class="token builtin">otherwise</span>     <span class="token operator">=</span> <span class="token builtin">fmap</span> <span class="token builtin">unzip3</span> <span class="token operator">$</span> <span class="token builtin">sequence</span> <span class="token hvariable">xs</span>
        <span class="token hvariable">toState</span> <span class="token punctuation">(</span><span class="token hvariable">wls</span><span class="token punctuation">,</span> <span class="token hvariable">ags</span><span class="token punctuation">,</span> <span class="token hvariable">trs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">initialState</span>
            <span class="token punctuation">{</span> <span class="token hvariable">walls</span>     <span class="token operator">=</span> <span class="token hvariable">S.unions</span> <span class="token hvariable">wls</span>
            <span class="token punctuation">,</span> <span class="token hvariable">agents</span>    <span class="token operator">=</span> <span class="token hvariable">S.unions</span> <span class="token hvariable">ags</span>
            <span class="token punctuation">,</span> <span class="token hvariable">treasures</span> <span class="token operator">=</span> <span class="token hvariable">S.unions</span> <span class="token hvariable">trs</span> <span class="token punctuation">}</span>
</code></pre>
<p>The <code>convertToText</code> function is the inverse of <code>parseMap</code>. It converts a <code>State</code> with sets of pairs into a <code>String</code> which is a grid.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">convertToText</span> <span class="token operator">::</span> <span class="token constant">State</span> <span class="token operator">-></span> <span class="token constant">String</span>
<span class="token hvariable">convertToText</span> <span class="token hvariable">state</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">walls</span><span class="token punctuation">,</span> <span class="token hvariable">agents</span><span class="token punctuation">,</span> <span class="token hvariable">treasures</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">unlines</span> <span class="token operator">$</span> <span class="token constant">S</span><span class="token punctuation">.</span><span class="token builtin">foldr</span> <span class="token punctuation">(</span><span class="token hvariable">add</span> <span class="token hvariable">treasureChar</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">.</span><span class="token builtin">foldr</span> <span class="token punctuation">(</span><span class="token hvariable">add</span> <span class="token hvariable">agentChar</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">.</span><span class="token builtin">foldr</span> <span class="token punctuation">(</span><span class="token hvariable">add</span> <span class="token hvariable">wallChar</span><span class="token punctuation">)</span> <span class="token hvariable">emptyGrid</span> <span class="token hvariable">walls</span><span class="token punctuation">)</span> <span class="token hvariable">agents</span><span class="token punctuation">)</span> <span class="token hvariable">treasures</span>
    <span class="token keyword">where</span>
        <span class="token hvariable">add</span> <span class="token hvariable">c</span> <span class="token operator">=</span> <span class="token operator">\</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token hvariable">acc</span> <span class="token operator">-></span>
            <span class="token keyword">let</span> <span class="token hvariable">accx</span> <span class="token operator">=</span> <span class="token hvariable">acc</span> <span class="token operator">!!</span> <span class="token punctuation">(</span><span class="token hvariable">yMax</span> <span class="token operator">-</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>
            <span class="token keyword">in</span>  <span class="token builtin">take</span> <span class="token punctuation">(</span><span class="token hvariable">yMax</span> <span class="token operator">-</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token hvariable">acc</span> <span class="token operator">++</span> <span class="token punctuation">[</span><span class="token builtin">take</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">-</span> <span class="token hvariable">xMin</span><span class="token punctuation">)</span> <span class="token hvariable">accx</span> <span class="token operator">++</span> <span class="token punctuation">[</span><span class="token hvariable">c</span><span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token builtin">drop</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">-</span> <span class="token hvariable">xMin</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token hvariable">accx</span><span class="token punctuation">]</span>
                <span class="token operator">++</span> <span class="token builtin">drop</span> <span class="token punctuation">(</span><span class="token hvariable">yMax</span> <span class="token operator">-</span> <span class="token hvariable">y</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token hvariable">acc</span>
        <span class="token hvariable">emptyGrid</span> <span class="token operator">=</span> <span class="token builtin">replicate</span> <span class="token punctuation">(</span><span class="token hvariable">yMax</span> <span class="token operator">-</span> <span class="token hvariable">yMin</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token builtin">replicate</span> <span class="token punctuation">(</span><span class="token hvariable">xMax</span> <span class="token operator">-</span> <span class="token hvariable">xMin</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token hvariable">emptyChar</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">xMax</span><span class="token punctuation">,</span> <span class="token hvariable">xMin</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token hvariable">yMax</span><span class="token punctuation">,</span> <span class="token hvariable">yMin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">maxMins</span> <span class="token hvariable">state</span>
</code></pre>
<p>And the <code>fitWindow</code> function fits all objects currently in the world into the window, with as much zoom as possible. It was kind of annoying to write because it involved a lot of calculations.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">fitWindow</span> <span class="token operator">::</span> <span class="token constant">State</span> <span class="token operator">-></span> <span class="token constant">State</span>
<span class="token hvariable">fitWindow</span> <span class="token hvariable">state</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">viewState</span><span class="token punctuation">,</span> <span class="token hvariable">windowW</span><span class="token punctuation">,</span> <span class="token hvariable">windowH</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">state</span>
    <span class="token punctuation">{</span> <span class="token hvariable">viewState</span> <span class="token operator">=</span> <span class="token hvariable">viewState</span>
        <span class="token punctuation">{</span> <span class="token hvariable">viewStateViewPort</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">viewStateViewPort</span> <span class="token hvariable">viewState</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span> <span class="token hvariable">viewPortScale</span> <span class="token operator">=</span> <span class="token builtin">min</span> <span class="token punctuation">(</span><span class="token builtin">fromIntegral</span> <span class="token hvariable">windowW</span> <span class="token operator">/</span> <span class="token builtin">fromIntegral</span> <span class="token punctuation">(</span><span class="token hvariable">xMax</span> <span class="token operator">-</span> <span class="token hvariable">xMin</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">(</span><span class="token builtin">fromIntegral</span> <span class="token hvariable">windowH</span> <span class="token operator">/</span> <span class="token builtin">fromIntegral</span> <span class="token punctuation">(</span><span class="token hvariable">yMax</span> <span class="token operator">-</span> <span class="token hvariable">yMin</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">,</span> <span class="token hvariable">viewPortTranslate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">fromIntegral</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token hvariable">xMax</span> <span class="token operator">+</span> <span class="token hvariable">xMin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">,</span> <span class="token builtin">fromIntegral</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token hvariable">yMax</span> <span class="token operator">+</span> <span class="token hvariable">yMin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token keyword">where</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">xMax</span><span class="token punctuation">,</span> <span class="token hvariable">xMin</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token hvariable">yMax</span><span class="token punctuation">,</span> <span class="token hvariable">yMin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">maxMins</span> <span class="token hvariable">state</span>
</code></pre>
<p>And here is the <code>maxMins</code> function which is used by both <code>convertToText</code> and <code>fitWindow</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">maxMins</span> <span class="token operator">::</span> <span class="token constant">State</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token hvariable">maxMins</span> <span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">walls</span><span class="token punctuation">,</span> <span class="token hvariable">agents</span><span class="token punctuation">,</span> <span class="token hvariable">treasures</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">S.findMax</span> <span class="token hvariable">xs</span><span class="token punctuation">,</span> <span class="token hvariable">S.findMin</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token hvariable">S.findMax</span> <span class="token hvariable">ys</span><span class="token punctuation">,</span> <span class="token hvariable">S.findMin</span> <span class="token hvariable">ys</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">where</span>
        <span class="token hvariable">everything</span> <span class="token operator">=</span> <span class="token hvariable">S.unions</span> <span class="token punctuation">[</span><span class="token hvariable">walls</span><span class="token punctuation">,</span> <span class="token hvariable">agents</span><span class="token punctuation">,</span> <span class="token hvariable">treasures</span><span class="token punctuation">]</span>
        <span class="token hvariable">xs</span>         <span class="token operator">=</span> <span class="token constant">S</span><span class="token punctuation">.</span><span class="token builtin">map</span> <span class="token builtin">fst</span> <span class="token operator">$</span> <span class="token hvariable">everything</span>
        <span class="token hvariable">ys</span>         <span class="token operator">=</span> <span class="token constant">S</span><span class="token punctuation">.</span><span class="token builtin">map</span> <span class="token builtin">snd</span> <span class="token operator">$</span> <span class="token hvariable">everything</span>
</code></pre>
<p>One thing that I discovered while working on this project is that my program can be used to create ASCII art, since you can draw walls and stuff and generate a text file from it. However the ASCII art would only contain <code>x</code>, <code>o</code>, and <code>$</code>, since those are the characters which represent walls, agents, and treasures.</p>
<p>In conclusion, I liked working on this GridWorld project a lot. But I spent a lot of time on it, so I didn&#39;t have time to do the optional TileWorld project.</p>
<p>This post only contains a small part of the code, so you should go to <a href="https://github.com/qsctr/gridworld/blob/master/src/Main.hs">GitHub</a> to read the full program.</p>
