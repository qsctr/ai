<h1 id="game-of-life">Game of Life</h1>
<p>See the source code on GitHub: <a href="https://github.com/qsctr/game-of-life">https://github.com/qsctr/game-of-life</a></p>
<p>Wikipedia article on Game of Life: <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life</a></p>
<h2 id="8-17-2016-">8/17/2016:</h2>
<p>I decided to make the Conway&#39;s Game of Life simulation using the Haskell programming language. Haskell is a purely functional programming langauge. For graphics I used a Haskell library called Gloss.</p>
<p>I had never used external Haskell libraries before, so I spend the first few days trying to figure out how to set everything up. In the end I found out I had to use a tool called stack to manage dependencies and build my project.</p>
<h2 id="8-19-2016-">8/19/2016:</h2>
<p>I finished the project today. The game has the following features:</p>
<ul>
<li>Play the Game</li>
<li>Pause</li>
<li>Add cells</li>
<li>Remove cells</li>
<li>Navigate around</li>
<li>Zoom in and out</li>
<li>Reset zoom and navigation</li>
<li>Restart game</li>
</ul>
<p>Gloss has the <code>play</code> function for displaying graphics.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">play</span> <span class="token punctuation">(</span><span class="token constant">InWindow</span> <span class="token string">"Game of Life"</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token hvariable">white</span> <span class="token number">5</span> <span class="token hvariable">initialWorld</span> <span class="token hvariable">drawWorld</span> <span class="token hvariable">handleInput</span> <span class="token hvariable">stepWorld</span>
</code></pre>
<p>The first arguments are all information about how the graphics should display. But the last 4 are variables or functions that are defined elsewhere. The functions are called with some data of any type. In this case I defined my own data type called <code>World</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">World</span> <span class="token operator">=</span> <span class="token constant">World</span> <span class="token punctuation">{</span> <span class="token hvariable">cells</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token hvariable">playing</span> <span class="token operator">::</span> <span class="token constant">Bool</span><span class="token punctuation">,</span> <span class="token hvariable">viewPort</span> <span class="token operator">::</span> <span class="token constant">ViewPort</span> <span class="token punctuation">}</span>
</code></pre>
<p>The <code>World</code> data type is a record type which contains 3 fields. Instead of the cells being a 2D matrix, I am storing a list of coordinates, so the &quot;grid&quot; can be (theoretically) infinitely big. Because Haskell is a purely functional language, I cannot store state in global variables. Instead I have to pass them around in a data type which gets passed to and returned by functions.</p>
<p><code>initialWorld</code> is self-explanatory. It is passed to <code>play</code> as the starting state.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">initialWorld</span> <span class="token operator">::</span> <span class="token constant">World</span>
<span class="token hvariable">initialWorld</span> <span class="token operator">=</span> <span class="token constant">World</span> <span class="token punctuation">{</span> <span class="token hvariable">cells</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token hvariable">playing</span> <span class="token operator">=</span> <span class="token constant">False</span><span class="token punctuation">,</span> <span class="token hvariable">viewPort</span> <span class="token operator">=</span> <span class="token hvariable">initialViewPort</span> <span class="token punctuation">}</span>
</code></pre>
<p><code>drawWorld</code> is a function which gets called by <code>play</code> to convert the game state into a <code>Picture</code>. The code is pretty self-explanatory too.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">drawWorld</span> <span class="token operator">::</span> <span class="token constant">World</span> <span class="token operator">-></span> <span class="token constant">Picture</span>
<span class="token hvariable">drawWorld</span> <span class="token constant">World</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token hvariable">applyViewPortToPicture</span> <span class="token hvariable">viewPort</span> <span class="token operator">$</span> <span class="token hvariable">pictures</span> <span class="token operator">$</span> <span class="token builtin">map</span> <span class="token hvariable">drawCell</span> <span class="token hvariable">cells</span>
    <span class="token keyword">where</span> <span class="token hvariable">drawCell</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">translate</span> <span class="token punctuation">(</span><span class="token builtin">fromIntegral</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">fromIntegral</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token hvariable">rectangleSolid</span> <span class="token number">1</span> <span class="token number">1</span>
</code></pre>
<p><code>stepWorld</code> is a function which is passed a game state and returns a new game state.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">stepWorld</span> <span class="token operator">::</span> <span class="token constant">Float</span> <span class="token operator">-></span> <span class="token constant">World</span> <span class="token operator">-></span> <span class="token constant">World</span>
<span class="token hvariable">stepWorld</span> <span class="token hvariable">_</span> <span class="token hvariable">world</span><span class="token operator">@</span><span class="token constant">World</span> <span class="token punctuation">{</span> <span class="token hvariable">playing</span> <span class="token operator">=</span> <span class="token constant">False</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token hvariable">world</span>
<span class="token hvariable">stepWorld</span> <span class="token hvariable">_</span> <span class="token hvariable">world</span><span class="token operator">@</span><span class="token constant">World</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token hvariable">world</span> <span class="token punctuation">{</span> <span class="token hvariable">cells</span> <span class="token operator">=</span> <span class="token hvariable">nub</span> <span class="token operator">$</span> <span class="token builtin">concatMap</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token hvariable">alive</span><span class="token operator"> . </span><span class="token hvariable">surrounding</span><span class="token punctuation">)</span> <span class="token hvariable">cells</span> <span class="token punctuation">}</span>
    <span class="token keyword">where</span> <span class="token hvariable">surrounding</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">w</span><span class="token punctuation">,</span> <span class="token hvariable">y</span> <span class="token operator">+</span> <span class="token hvariable">h</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token hvariable">w</span> <span class="token operator">&lt;-</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token hvariable">h</span> <span class="token operator">&lt;-</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
          <span class="token hvariable">alive</span> <span class="token hvariable">cell</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token hvariable">neighbors</span> <span class="token operator">==</span> <span class="token number">4</span> <span class="token keyword">then</span> <span class="token hvariable">cell</span> `<span class="token builtin">elem</span>` <span class="token hvariable">cells</span> <span class="token keyword">else</span> <span class="token hvariable">neighbors</span> <span class="token operator">==</span> <span class="token number">3</span>
              <span class="token keyword">where</span> <span class="token hvariable">neighbors</span> <span class="token operator">=</span> <span class="token builtin">length</span> <span class="token operator">$</span> <span class="token builtin">filter</span> <span class="token punctuation">(</span>`<span class="token builtin">elem</span>` <span class="token hvariable">cells</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token hvariable">surrounding</span> <span class="token hvariable">cell</span>
</code></pre>
<p>If <code>playing</code> is <code>False</code> then the world stays the same. Otherwise, for each cell that is existing in the list, a function is mapped to it which obtains the surrounding cells as a list, and returns the ones that should be alive in the next generation. This is because the only cells that could be alive are the ones that are surrounding existing alive cells. I cannot go through the entire grid because the grid is infinite in my implementation. Then, the list of lists of new cells is flattened, and duplicates are removed, and it is returned by <code>stepWorld</code>.</p>
<p>This function is quite inefficient, since the lists in Haskell are actually linked lists, which for certain operations take a very long time. One way that I could improve this is by skipping some cells which are unnecessary to be checked. Also, Haskell has a Set data type which is more efficient, and automatically does not allow duplicates. Switching to that should improve performance.</p>
<p>Finally, the <code>handleInput</code> function is passed an input event, for example a key press, and the current state, and it returns a new state.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">handleInput</span> <span class="token operator">::</span> <span class="token constant">Event</span> <span class="token operator">-></span> <span class="token constant">World</span> <span class="token operator">-></span> <span class="token constant">World</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventKey</span> <span class="token punctuation">(</span><span class="token constant">SpecialKey</span> <span class="token constant">KeySpace</span><span class="token punctuation">)</span> <span class="token constant">Down</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token hvariable">world</span><span class="token operator">@</span><span class="token constant">World</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token hvariable">world</span> <span class="token punctuation">{</span> <span class="token hvariable">playing</span> <span class="token operator">=</span> <span class="token builtin">not</span> <span class="token hvariable">playing</span> <span class="token punctuation">}</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventKey</span> <span class="token punctuation">(</span><span class="token constant">MouseButton</span> <span class="token hvariable">button</span><span class="token punctuation">)</span> <span class="token constant">Down</span> <span class="token hvariable">_</span> <span class="token hvariable">coords</span><span class="token punctuation">)</span> <span class="token hvariable">world</span><span class="token operator">@</span><span class="token constant">World</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token hvariable">button</span> <span class="token operator">==</span> <span class="token constant">LeftButton</span> <span class="token operator">&amp;&amp;</span> <span class="token hvariable">cell</span> `<span class="token builtin">notElem</span>` <span class="token hvariable">cells</span> <span class="token operator">=</span> <span class="token hvariable">world</span> <span class="token punctuation">{</span> <span class="token hvariable">cells</span> <span class="token operator">=</span> <span class="token hvariable">cell</span> <span class="token operator">:</span> <span class="token hvariable">cells</span> <span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token hvariable">button</span> <span class="token operator">==</span> <span class="token constant">RightButton</span> <span class="token operator">&amp;&amp;</span> <span class="token hvariable">cell</span> `<span class="token builtin">elem</span>` <span class="token hvariable">cells</span> <span class="token operator">=</span> <span class="token hvariable">world</span> <span class="token punctuation">{</span> <span class="token hvariable">cells</span> <span class="token operator">=</span> <span class="token hvariable">delete</span> <span class="token hvariable">cell</span> <span class="token hvariable">cells</span> <span class="token punctuation">}</span>
    <span class="token keyword">where</span> <span class="token hvariable">cell</span> <span class="token operator">=</span> <span class="token hvariable">mapPair</span> <span class="token builtin">round</span> <span class="token operator">$</span> <span class="token hvariable">invertViewPort</span> <span class="token hvariable">viewPort</span> <span class="token hvariable">coords</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventKey</span> <span class="token punctuation">(</span><span class="token constant">SpecialKey</span> <span class="token hvariable">key</span><span class="token punctuation">)</span> <span class="token constant">Down</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token hvariable">world</span><span class="token operator">@</span><span class="token constant">World</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token hvariable">key</span> <span class="token operator">==</span> <span class="token constant">KeyLeft</span> <span class="token operator">=</span> <span class="token hvariable">t</span> <span class="token punctuation">(</span><span class="token hvariable">tx</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token hvariable">ty</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token hvariable">key</span> <span class="token operator">==</span> <span class="token constant">KeyRight</span> <span class="token operator">=</span> <span class="token hvariable">t</span> <span class="token punctuation">(</span><span class="token hvariable">tx</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token hvariable">ty</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token hvariable">key</span> <span class="token operator">==</span> <span class="token constant">KeyUp</span> <span class="token operator">=</span> <span class="token hvariable">t</span> <span class="token punctuation">(</span><span class="token hvariable">tx</span><span class="token punctuation">,</span> <span class="token hvariable">ty</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token hvariable">key</span> <span class="token operator">==</span> <span class="token constant">KeyDown</span> <span class="token operator">=</span> <span class="token hvariable">t</span> <span class="token punctuation">(</span><span class="token hvariable">tx</span><span class="token punctuation">,</span> <span class="token hvariable">ty</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">where</span> <span class="token hvariable">t</span> <span class="token hvariable">translation</span> <span class="token operator">=</span> <span class="token hvariable">world</span> <span class="token punctuation">{</span> <span class="token hvariable">viewPort</span> <span class="token operator">=</span> <span class="token hvariable">viewPort</span> <span class="token punctuation">{</span> <span class="token hvariable">viewPortTranslate</span> <span class="token operator">=</span> <span class="token hvariable">translation</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
          <span class="token punctuation">(</span><span class="token hvariable">tx</span><span class="token punctuation">,</span> <span class="token hvariable">ty</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">viewPortTranslate</span> <span class="token hvariable">viewPort</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventKey</span> <span class="token punctuation">(</span><span class="token constant">Char</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token constant">Down</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token hvariable">world</span><span class="token operator">@</span><span class="token constant">World</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token hvariable">c</span> <span class="token operator">==</span> <span class="token char">'z'</span> <span class="token operator">=</span> <span class="token hvariable">s</span> <span class="token operator">$</span> <span class="token hvariable">zoom</span> <span class="token operator">+</span> <span class="token number">2</span>
    <span class="token operator">|</span> <span class="token hvariable">c</span> <span class="token operator">==</span> <span class="token char">'x'</span> <span class="token operator">=</span> <span class="token hvariable">s</span> <span class="token operator">$</span> <span class="token builtin">max</span> <span class="token number">1</span> <span class="token operator">$</span> <span class="token hvariable">zoom</span> <span class="token operator">-</span> <span class="token number">2</span>
    <span class="token keyword">where</span> <span class="token hvariable">s</span> <span class="token hvariable">factor</span> <span class="token operator">=</span> <span class="token hvariable">world</span> <span class="token punctuation">{</span> <span class="token hvariable">viewPort</span> <span class="token operator">=</span> <span class="token hvariable">viewPort</span> <span class="token punctuation">{</span> <span class="token hvariable">viewPortScale</span> <span class="token operator">=</span> <span class="token hvariable">factor</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
          <span class="token hvariable">zoom</span> <span class="token operator">=</span> <span class="token hvariable">viewPortScale</span> <span class="token hvariable">viewPort</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventKey</span> <span class="token punctuation">(</span><span class="token constant">Char</span> <span class="token char">'c'</span><span class="token punctuation">)</span> <span class="token constant">Down</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token hvariable">world</span> <span class="token operator">=</span> <span class="token hvariable">world</span> <span class="token punctuation">{</span> <span class="token hvariable">viewPort</span> <span class="token operator">=</span> <span class="token hvariable">initialViewPort</span> <span class="token punctuation">}</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventKey</span> <span class="token punctuation">(</span><span class="token constant">Char</span> <span class="token char">'r'</span><span class="token punctuation">)</span> <span class="token constant">Down</span> <span class="token hvariable">_</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token hvariable">initialWorld</span>
<span class="token hvariable">handleInput</span> <span class="token hvariable">_</span> <span class="token hvariable">world</span> <span class="token operator">=</span> <span class="token hvariable">world</span>
</code></pre>
<p>The single function handles all of the features that respond to input such as adding and removing cells, zooming, etc.</p>
<p>So, that is pretty much the whole program. I think this graphics library is quite easy to use, so I will probably use it in the future if I am doing graphics with Haskell again. I enjoyed writing this program in Haskell, since it makes me think differently than when I am writing Java. Besides learning things about programming and graphics, I also learned that playing the Game of Life is very fun and I will probably play it in the future when I am bored. I am surprised at how the cells can seem to have complicated patterns while following very simple rules.</p>
<h2 id="8-22-2016-">8/22/2016:</h2>
<p>I changed <code>cells</code> from a linked list to a <code>Set</code>. Set is a data type which is ordered and cannot have duplicates. The program can now run way faster without lagging.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">World</span> <span class="token operator">=</span> <span class="token constant">World</span> <span class="token punctuation">{</span> <span class="token hvariable">cells</span> <span class="token operator">::</span> <span class="token constant">Set</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">playing</span> <span class="token operator">::</span> <span class="token constant">Bool</span><span class="token punctuation">,</span> <span class="token hvariable">viewPort</span> <span class="token operator">::</span> <span class="token constant">ViewPort</span> <span class="token punctuation">}</span>
</code></pre>
<p>You can see the exact things that I changed in the commit diff.</p>
<p><a href="https://github.com/qsctr/game-of-life/commit/995356ce07d57f712cf79d8563f498391f05c9d3">https://github.com/qsctr/game-of-life/commit/995356ce07d57f712cf79d8563f498391f05c9d3</a></p>
