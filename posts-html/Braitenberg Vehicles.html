<h1 id="braitenberg-vehicles">Braitenberg Vehicles</h1>
<p>See the source code on GitHub: <a href="https://github.com/qsctr/vehicles">https://github.com/qsctr/vehicles</a></p>
<p>Wikipedia article on Braitenberg Vehicles: <a href="https://en.wikipedia.org/wiki/Braitenberg_vehicle">https://en.wikipedia.org/wiki/Braitenberg_vehicle</a></p>
<h2 id="8-26-2016-">8/26/2016:</h2>
<p>Today I made a picture of a vehicle with two wheels.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">vehicle</span> <span class="token operator">::</span> <span class="token constant">Picture</span>
<span class="token hvariable">vehicle</span> <span class="token operator">=</span> <span class="token hvariable">scale</span> <span class="token number">2</span> <span class="token number">2</span> <span class="token operator">$</span> <span class="token hvariable">pictures</span>
    <span class="token punctuation">[</span> <span class="token hvariable">rectangleWire</span> <span class="token number">30</span> <span class="token number">20</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token hvariable">wheel</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token number">13</span> <span class="token operator">$</span> <span class="token hvariable">wheel</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token number">0</span> <span class="token number">6</span> <span class="token operator">$</span> <span class="token hvariable">sensor</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token hvariable">sensor</span> <span class="token punctuation">]</span>
    <span class="token keyword">where</span> <span class="token hvariable">wheel</span> <span class="token operator">=</span> <span class="token hvariable">rectangleWire</span> <span class="token number">12</span> <span class="token number">6</span>
          <span class="token hvariable">sensor</span> <span class="token operator">=</span> <span class="token hvariable">translate</span> <span class="token number">15</span> <span class="token number">0</span> <span class="token operator">$</span> <span class="token hvariable">pictures</span>
              <span class="token punctuation">[</span> <span class="token hvariable">line</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
              <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token number">13</span> <span class="token number">0</span> <span class="token operator">$</span> <span class="token hvariable">arc</span> <span class="token number">90</span> <span class="token number">270</span> <span class="token number">3</span> <span class="token punctuation">]</span>
</code></pre>
<p>The result looks like this.</p>
<p><img src="images/vehicle.png" alt="A two wheeled vehicle"></p>
<h2 id="9-6-2016">9/6/2016</h2>
<p>Yesterday I finished the project. I originally planned to do more things, but I also had lots of other homework this week, so I didn&#39;t do a lot of extra stuff.</p>
<p>I spent a long time thinking about how a vehicle should be represented. In the end I decided to represent a vehicle as a function, because if you think about it, you continuously put information in (where the source is) and continuously get information out (the new vehicle location and angle). However, in order for the function to be referentially transparent, i.e. determines its outputs from only its inputs, you need to pass the time that has passed, so it knows how much to advance, and the previous vehicle location and angle.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">type</span> <span class="token constant">VehicleFunction</span> <span class="token operator">=</span> <span class="token constant">SourceLocation</span> <span class="token operator">-></span> <span class="token constant">TimePassed</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span>
</code></pre>
<p>And here is <code>VehicleState</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">VehicleState</span> <span class="token operator">=</span> <span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span> <span class="token operator">::</span> <span class="token constant">Point</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token operator">::</span> <span class="token constant">Float</span> <span class="token punctuation">}</span>
</code></pre>
<p>However, the <code>VehicleFunction</code> only specifies the type of vehicle. In other words, it only has the rules, and not the actual information. Here is a complete <code>Vehicle</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Vehicle</span> <span class="token operator">=</span> <span class="token constant">Vehicle</span> <span class="token punctuation">{</span> <span class="token hvariable">function</span> <span class="token operator">::</span> <span class="token constant">VehicleFunction</span><span class="token punctuation">,</span> <span class="token hvariable">picture</span> <span class="token operator">::</span> <span class="token constant">Picture</span><span class="token punctuation">,</span> <span class="token hvariable">state</span> <span class="token operator">::</span> <span class="token constant">VehicleState</span> <span class="token punctuation">}</span>
</code></pre>
<p>The <code>function</code> field is the rule of the vehicle, the <code>picture</code> field is a picture of it, and the <code>state</code> field contains its state.</p>
<p>For this project, we are supposed to make each vehicle have <code>sense</code>, <code>decide</code>, and <code>act</code> commands, to be like an agent. So, I created the <code>makeVehicle</code> function, which, when passed three functions (<code>sense</code>, <code>decide</code>, <code>act</code>), and a <code>Picture</code>, returns a <code>Vehicle</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">makeVehicle</span>
    <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">SourceLocation</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token hvariable">sensorValues</span><span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true">-- sense</span>
    <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token hvariable">sensorValues</span> <span class="token operator">-></span> <span class="token hvariable">motorVelocities</span><span class="token punctuation">)</span>                                <span class="token comment" spellcheck="true">-- decide</span>
    <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token constant">TimePassed</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token hvariable">motorVelocities</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">-- act</span>
    <span class="token operator">-></span> <span class="token constant">Picture</span>
    <span class="token operator">-></span> <span class="token constant">Vehicle</span>
<span class="token hvariable">makeVehicle</span> <span class="token hvariable">sense</span> <span class="token hvariable">decide</span> <span class="token hvariable">act</span> <span class="token hvariable">pic</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">vFunc</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">t</span> <span class="token hvariable">vSt</span> <span class="token operator">=</span> <span class="token hvariable">limitAct</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">t</span> <span class="token hvariable">vSt</span> <span class="token operator">$</span> <span class="token hvariable">decide</span> <span class="token operator">$</span> <span class="token hvariable">sense</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">vSt</span>
        <span class="token hvariable">limitAct</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">t</span> <span class="token hvariable">vSt</span> <span class="token hvariable">v</span> <span class="token operator">=</span>
            <span class="token keyword">let</span> <span class="token hvariable">newVSt</span> <span class="token operator">=</span> <span class="token hvariable">act</span> <span class="token hvariable">t</span> <span class="token hvariable">vSt</span> <span class="token hvariable">v</span>
            <span class="token keyword">in</span>  <span class="token keyword">if</span> <span class="token hvariable">distance</span> <span class="token punctuation">(</span><span class="token hvariable">location</span> <span class="token hvariable">newVSt</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">location</span> <span class="token hvariable">vSt</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.03</span>
                    <span class="token operator">&amp;&amp;</span> <span class="token hvariable">distance</span> <span class="token hvariable">sourceLoc</span> <span class="token punctuation">(</span><span class="token hvariable">location</span> <span class="token hvariable">vSt</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">58</span>
                <span class="token keyword">then</span> <span class="token hvariable">vSt</span> <span class="token keyword">else</span> <span class="token hvariable">newVSt</span>
        <span class="token hvariable">defaultState</span> <span class="token operator">=</span> <span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token keyword">in</span>  <span class="token constant">Vehicle</span> <span class="token hvariable">vFunc</span> <span class="token hvariable">pic</span> <span class="token hvariable">defaultState</span>
</code></pre>
<p>It combines the <code>sense</code>, <code>decide</code>, and <code>act</code> commands to create the <code>function</code>, then puts that together with a default state and the supplied picture.</p>
<p>Here is the <code>sensorRule</code> function. It is applied to the distance between the source and the sensor, to get the sensor value.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">sensorRule</span> <span class="token operator">::</span> <span class="token constant">Distance</span> <span class="token operator">-></span> <span class="token constant">SensorValue</span>
<span class="token hvariable">sensorRule</span> <span class="token hvariable">x</span>
    <span class="token operator">|</span> <span class="token hvariable">x</span> <span class="token operator">&lt;</span> <span class="token hvariable">mouseCircleRadius</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token hvariable">x</span> <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1e6</span>
    <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token number">0</span>
</code></pre>
<p>The rule is to apply the inverse square law, then multiply by 1e6.</p>
<p>Since many vehicle share the same <code>sense</code> and <code>act</code> commands, I decided to separate them into different modules which can be imported by the vehicles that need them. So, I created the modules <code>Vehicles.OneWheeled</code> and <code>Vehicles.TwoWheeled</code>. (There is only one one-wheeled vehicle, but I wanted it to be consistent.)</p>
<p>Here are the important functions and values in <code>OneWheeled</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">vehiclePicture</span> <span class="token operator">::</span> <span class="token constant">Picture</span>
<span class="token hvariable">vehiclePicture</span> <span class="token operator">=</span> <span class="token hvariable">pictures</span>
    <span class="token punctuation">[</span> <span class="token hvariable">rectangleWire</span> <span class="token hvariable">width</span> <span class="token number">20</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token hvariable">wheel</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token punctuation">(</span><span class="token hvariable">width</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token hvariable">sensorPositionY</span> <span class="token hvariable">sensor</span> <span class="token punctuation">]</span>

<span class="token hvariable">sense</span> <span class="token operator">::</span> <span class="token constant">SourceLocation</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token constant">SensorValue</span>
<span class="token hvariable">sense</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">vSt</span> <span class="token operator">=</span> <span class="token hvariable">applySensorRule</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">vSt</span> <span class="token hvariable">sensorPosition</span>

<span class="token hvariable">act</span> <span class="token operator">::</span> <span class="token constant">TimePassed</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token constant">MotorVelocity</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span>
<span class="token hvariable">act</span> <span class="token hvariable">t</span> <span class="token punctuation">(</span><span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token hvariable">v</span> <span class="token operator">=</span>
    <span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span> <span class="token operator">=</span> <span class="token hvariable">moveAtAngle</span> <span class="token hvariable">angle</span> <span class="token punctuation">(</span><span class="token hvariable">v</span> <span class="token operator">*</span> <span class="token hvariable">t</span><span class="token punctuation">)</span> <span class="token hvariable">location</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token punctuation">}</span>
</code></pre>
<p>This code is pretty simple, since the vehicle only has one sensor and moves in a straight line.</p>
<p>Here are the important functions from <code>TwoWheeled</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">vehiclePicture</span> <span class="token operator">::</span> <span class="token constant">Picture</span>
<span class="token hvariable">vehiclePicture</span> <span class="token operator">=</span> <span class="token hvariable">pictures</span>
    <span class="token punctuation">[</span> <span class="token hvariable">rectangleWire</span> <span class="token hvariable">width</span> <span class="token number">40</span>
    <span class="token punctuation">,</span> <span class="token builtin">uncurry</span> <span class="token hvariable">translate</span> <span class="token hvariable">lWheelPosition</span> <span class="token hvariable">wheel</span>
    <span class="token punctuation">,</span> <span class="token builtin">uncurry</span> <span class="token hvariable">translate</span> <span class="token hvariable">rWheelPosition</span> <span class="token hvariable">wheel</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token punctuation">(</span><span class="token hvariable">width</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token hvariable">sensorPositionsY</span> <span class="token hvariable">sensor</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token punctuation">(</span><span class="token hvariable">width</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token hvariable">sensorPositionsY</span><span class="token punctuation">)</span> <span class="token hvariable">sensor</span> <span class="token punctuation">]</span>

<span class="token hvariable">sense</span> <span class="token operator">::</span> <span class="token constant">SourceLocation</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token constant">SensorValue</span><span class="token punctuation">,</span> <span class="token constant">SensorValue</span><span class="token punctuation">)</span>
<span class="token hvariable">sense</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">vSt</span> <span class="token operator">=</span> <span class="token hvariable">mapPair</span> <span class="token punctuation">(</span><span class="token hvariable">applySensorRule</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">vSt</span><span class="token punctuation">)</span> <span class="token hvariable">sensorPositions</span>

<span class="token hvariable">act</span> <span class="token operator">::</span> <span class="token constant">TimePassed</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token constant">MotorVelocity</span><span class="token punctuation">,</span> <span class="token constant">MotorVelocity</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span>
<span class="token hvariable">act</span> <span class="token hvariable">t</span> <span class="token punctuation">(</span><span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">vl</span><span class="token punctuation">,</span> <span class="token hvariable">vr</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">dl</span><span class="token punctuation">,</span> <span class="token hvariable">dr</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">vl</span> <span class="token operator">*</span> <span class="token hvariable">t</span><span class="token punctuation">,</span> <span class="token hvariable">vr</span> <span class="token operator">*</span> <span class="token hvariable">t</span><span class="token punctuation">)</span>
        <span class="token hvariable">moveWheel</span> <span class="token hvariable">d</span> <span class="token hvariable">wheelPos</span> <span class="token operator">=</span> <span class="token hvariable">moveAtAngle</span> <span class="token hvariable">angle</span> <span class="token hvariable">d</span> <span class="token operator">$</span> <span class="token hvariable">addPoints</span> <span class="token hvariable">location</span> <span class="token operator">$</span> <span class="token hvariable">rotatePoint</span> <span class="token hvariable">angle</span> <span class="token hvariable">wheelPos</span>
        <span class="token punctuation">(</span><span class="token hvariable">newLeftLoc</span><span class="token punctuation">,</span> <span class="token hvariable">newRightLoc</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">moveWheel</span> <span class="token hvariable">dl</span> <span class="token hvariable">lWheelPosition</span><span class="token punctuation">,</span> <span class="token hvariable">moveWheel</span> <span class="token hvariable">dr</span> <span class="token hvariable">rWheelPosition</span><span class="token punctuation">)</span>
        <span class="token hvariable">newLocation</span> <span class="token operator">=</span> <span class="token hvariable">subtractPoints</span> <span class="token punctuation">(</span><span class="token hvariable">midpoint</span> <span class="token hvariable">newLeftLoc</span> <span class="token hvariable">newRightLoc</span><span class="token punctuation">)</span> <span class="token operator">$</span>
            <span class="token hvariable">rotatePoint</span> <span class="token hvariable">newAngle</span> <span class="token punctuation">(</span><span class="token hvariable">wheelPositionsX</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token hvariable">newAngle</span> <span class="token operator">=</span> <span class="token hvariable">addAngles</span> <span class="token hvariable">angle</span> <span class="token operator">$</span> <span class="token builtin">atan</span>' <span class="token operator">$</span> <span class="token punctuation">(</span><span class="token hvariable">dr</span> <span class="token operator">-</span> <span class="token hvariable">dl</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token hvariable">wheelPositionsY</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">in</span>  <span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span> <span class="token operator">=</span> <span class="token hvariable">newLocation</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token operator">=</span> <span class="token hvariable">newAngle</span> <span class="token punctuation">}</span>
</code></pre>
<p>The <code>act</code> function is a lot more complicated, which I won&#39;t explain here but you can understand by reading the code.</p>
<p>You might notice that there are a lot of math functions such as <code>moveAtAngle</code>. They are defined in the module <code>Vehicles.Math</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token comment" spellcheck="true">-- you already saw this before</span>
<span class="token hvariable">sensorRule</span> <span class="token operator">::</span> <span class="token constant">Distance</span> <span class="token operator">-></span> <span class="token constant">SensorValue</span>
<span class="token hvariable">sensorRule</span> <span class="token hvariable">x</span>
    <span class="token operator">|</span> <span class="token hvariable">x</span> <span class="token operator">&lt;</span> <span class="token hvariable">mouseCircleRadius</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token hvariable">x</span> <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1e6</span> <span class="token comment" spellcheck="true">-- inverse square law</span>
    <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token number">0</span>

<span class="token hvariable">inverse</span> <span class="token operator">::</span> <span class="token constant">SensorValue</span> <span class="token operator">-></span> <span class="token constant">MotorVelocity</span>
<span class="token hvariable">inverse</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token hvariable">inverse</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token number">1e4</span> <span class="token operator">/</span> <span class="token hvariable">x</span> <span class="token comment" spellcheck="true">-- this is to prevent the motor power from being too small for inversed vehicles</span>

<span class="token hvariable">distance</span> <span class="token operator">::</span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Distance</span>
<span class="token hvariable">distance</span> <span class="token punctuation">(</span><span class="token hvariable">x1</span><span class="token punctuation">,</span> <span class="token hvariable">y1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">x2</span><span class="token punctuation">,</span> <span class="token hvariable">y2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">sqrt</span> <span class="token operator">$</span> <span class="token punctuation">(</span><span class="token hvariable">x2</span> <span class="token operator">-</span> <span class="token hvariable">x1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token hvariable">y2</span> <span class="token operator">-</span> <span class="token hvariable">y1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">2</span>

<span class="token hvariable">midpoint</span> <span class="token operator">::</span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span>
<span class="token hvariable">midpoint</span> <span class="token punctuation">(</span><span class="token hvariable">x1</span><span class="token punctuation">,</span> <span class="token hvariable">y1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">x2</span><span class="token punctuation">,</span> <span class="token hvariable">y2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">x1</span> <span class="token operator">+</span> <span class="token hvariable">x2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token hvariable">y1</span> <span class="token operator">+</span> <span class="token hvariable">y2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token hvariable">moveAtAngle</span> <span class="token operator">::</span> <span class="token constant">Angle</span> <span class="token operator">-></span> <span class="token constant">Distance</span> <span class="token operator">-></span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span>
<span class="token hvariable">moveAtAngle</span> <span class="token hvariable">angle</span> <span class="token hvariable">d</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token builtin">cos</span>' <span class="token hvariable">angle</span> <span class="token operator">*</span> <span class="token hvariable">d</span><span class="token punctuation">,</span> <span class="token hvariable">y</span> <span class="token operator">+</span> <span class="token builtin">sin</span>' <span class="token hvariable">angle</span> <span class="token operator">*</span> <span class="token hvariable">d</span><span class="token punctuation">)</span>

<span class="token hvariable">rotatePoint</span> <span class="token operator">::</span> <span class="token constant">Angle</span> <span class="token operator">-></span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span>
<span class="token hvariable">rotatePoint</span> <span class="token hvariable">angle</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token hvariable">moveAtAngle</span> <span class="token punctuation">(</span><span class="token hvariable">addAngles</span> <span class="token hvariable">angle</span> <span class="token operator">$</span> <span class="token builtin">atan</span>' <span class="token operator">$</span> <span class="token hvariable">y</span> <span class="token operator">/</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">distance</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token hvariable">addAngles</span> <span class="token operator">::</span> <span class="token constant">Angle</span> <span class="token operator">-></span> <span class="token constant">Angle</span> <span class="token operator">-></span> <span class="token constant">Angle</span>
<span class="token hvariable">addAngles</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">wrap</span> <span class="token hvariable">x</span>
            <span class="token operator">|</span> <span class="token hvariable">x</span> <span class="token operator">></span> <span class="token number">360</span> <span class="token operator">=</span> <span class="token hvariable">wrap</span> <span class="token operator">$</span> <span class="token hvariable">x</span> <span class="token operator">-</span> <span class="token number">360</span>
            <span class="token operator">|</span> <span class="token hvariable">x</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token hvariable">wrap</span> <span class="token operator">$</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token number">360</span>
            <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token hvariable">x</span>
    <span class="token keyword">in</span>  <span class="token hvariable">wrap</span> <span class="token operator">$</span> <span class="token hvariable">a</span> <span class="token operator">+</span> <span class="token hvariable">b</span>

<span class="token hvariable">addPoints</span> <span class="token operator">::</span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span>
<span class="token hvariable">addPoints</span> <span class="token punctuation">(</span><span class="token hvariable">x1</span><span class="token punctuation">,</span> <span class="token hvariable">y1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">x2</span><span class="token punctuation">,</span> <span class="token hvariable">y2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">x1</span> <span class="token operator">+</span> <span class="token hvariable">x2</span><span class="token punctuation">,</span> <span class="token hvariable">y1</span> <span class="token operator">+</span> <span class="token hvariable">y2</span><span class="token punctuation">)</span>

<span class="token hvariable">subtractPoints</span> <span class="token operator">::</span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span> <span class="token operator">-></span> <span class="token constant">Point</span>
<span class="token hvariable">subtractPoints</span> <span class="token punctuation">(</span><span class="token hvariable">x1</span><span class="token punctuation">,</span> <span class="token hvariable">y1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">x2</span><span class="token punctuation">,</span> <span class="token hvariable">y2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">x1</span> <span class="token operator">-</span> <span class="token hvariable">x2</span><span class="token punctuation">,</span> <span class="token hvariable">y1</span> <span class="token operator">-</span> <span class="token hvariable">y2</span><span class="token punctuation">)</span>

<span class="token hvariable">mapPair</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token hvariable">b</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">)</span>
<span class="token hvariable">mapPair</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">f</span> <span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">f</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">-- The built-in trigonometry functions in Haskell use radians, so I have to convert the values.</span>
<span class="token builtin">sin</span>'<span class="token punctuation">,</span> <span class="token builtin">cos</span>'<span class="token punctuation">,</span> <span class="token builtin">atan</span>' <span class="token operator">::</span> <span class="token constant">Float</span> <span class="token operator">-></span> <span class="token constant">Float</span>
<span class="token builtin">sin</span>' <span class="token operator">=</span> <span class="token builtin">sin</span><span class="token operator"> . </span><span class="token hvariable">degToRad</span>
<span class="token builtin">cos</span>' <span class="token operator">=</span> <span class="token builtin">cos</span><span class="token operator"> . </span><span class="token hvariable">degToRad</span>
<span class="token builtin">atan</span>' <span class="token operator">=</span> <span class="token hvariable">radToDeg</span><span class="token operator"> . </span><span class="token builtin">atan</span>
</code></pre>
<p>Also, here is the <code>applySensorRule</code> function which was used in both one-wheeled and two-wheeled vehicles.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">applySensorRule</span> <span class="token operator">::</span> <span class="token constant">SourceLocation</span> <span class="token operator">-></span> <span class="token constant">VehicleState</span> <span class="token operator">-></span> <span class="token constant">SensorPosition</span> <span class="token operator">-></span> <span class="token constant">SensorValue</span>
<span class="token hvariable">applySensorRule</span> <span class="token hvariable">sourceLoc</span> <span class="token punctuation">(</span><span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token hvariable">sensorRule</span><span class="token operator"> . </span><span class="token hvariable">distance</span> <span class="token hvariable">sourceLoc</span><span class="token operator"> . </span><span class="token hvariable">addPoints</span> <span class="token hvariable">location</span><span class="token operator"> . </span><span class="token hvariable">rotatePoint</span> <span class="token hvariable">angle</span>
</code></pre>
<p>You might notice that instead of having three arguments, like the function signature implies, only two arguments are written. This is because the right side of the = sign is a function, which is a composition of many functions. This works because in Haskell functions are curried.</p>
<p>And here is the module <code>Vehicle.Parts</code>, which defines some common parts for the pictures of the vehicles.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">wheel</span> <span class="token operator">::</span> <span class="token constant">Picture</span>
<span class="token hvariable">wheel</span> <span class="token operator">=</span> <span class="token hvariable">rectangleWire</span> <span class="token number">24</span> <span class="token number">12</span>

<span class="token hvariable">sensor</span> <span class="token operator">::</span> <span class="token constant">Picture</span>
<span class="token hvariable">sensor</span> <span class="token operator">=</span> <span class="token hvariable">pictures</span>
    <span class="token punctuation">[</span> <span class="token hvariable">line</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token hvariable">sensorLineLength</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">,</span> <span class="token hvariable">translate</span> <span class="token hvariable">sensorOffset</span> <span class="token number">0</span> <span class="token operator">$</span> <span class="token hvariable">arc</span> <span class="token number">90</span> <span class="token number">270</span> <span class="token hvariable">sensorRadius</span> <span class="token punctuation">]</span>

<span class="token hvariable">sensorLineLength</span><span class="token punctuation">,</span> <span class="token hvariable">sensorRadius</span><span class="token punctuation">,</span> <span class="token hvariable">sensorOffset</span> <span class="token operator">::</span> <span class="token constant">Float</span>
<span class="token hvariable">sensorLineLength</span> <span class="token operator">=</span> <span class="token number">20</span>
<span class="token hvariable">sensorRadius</span> <span class="token operator">=</span> <span class="token number">6</span>
<span class="token hvariable">sensorOffset</span> <span class="token operator">=</span> <span class="token hvariable">sensorLineLength</span> <span class="token operator">+</span> <span class="token hvariable">sensorRadius</span>
</code></pre>
<p>With all these functions defined, the actual definitions for the vehicles are quite simple.</p>
<p>For <code>vehicle1</code> the <code>sense</code> and <code>act</code> are from the module <code>Vehicles.OneWheeled</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">vehicle1</span> <span class="token operator">::</span> <span class="token constant">Vehicle</span>
<span class="token hvariable">vehicle1</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">decide</span> <span class="token operator">=</span> <span class="token builtin">id</span>
    <span class="token keyword">in</span>  <span class="token hvariable">makeVehicle</span> <span class="token hvariable">sense</span> <span class="token hvariable">decide</span> <span class="token hvariable">act</span> <span class="token hvariable">vehiclePicture</span>
</code></pre>
<p>For the rest of the vehicles they all use <code>Vehicles.TwoWheeled</code>.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">vehicle2a</span> <span class="token operator">::</span> <span class="token constant">Vehicle</span>
<span class="token hvariable">vehicle2a</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">decide</span> <span class="token operator">=</span> <span class="token builtin">id</span>
    <span class="token keyword">in</span>  <span class="token hvariable">makeVehicle</span> <span class="token hvariable">sense</span> <span class="token hvariable">decide</span> <span class="token hvariable">act</span> <span class="token hvariable">vehiclePicture</span>

<span class="token hvariable">vehicle2b</span> <span class="token operator">::</span> <span class="token constant">Vehicle</span>
<span class="token hvariable">vehicle2b</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">decide</span> <span class="token operator">=</span> <span class="token hvariable">swap</span>
    <span class="token keyword">in</span>  <span class="token hvariable">makeVehicle</span> <span class="token hvariable">sense</span> <span class="token hvariable">decide</span> <span class="token hvariable">act</span> <span class="token hvariable">vehiclePicture</span>

<span class="token hvariable">vehicle2c</span> <span class="token operator">::</span> <span class="token constant">Vehicle</span>
<span class="token hvariable">vehicle2c</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">decide</span> <span class="token punctuation">(</span><span class="token hvariable">l</span><span class="token punctuation">,</span> <span class="token hvariable">r</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">let</span> <span class="token hvariable">avg</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">l</span> <span class="token operator">+</span> <span class="token hvariable">r</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token hvariable">avg</span><span class="token punctuation">,</span> <span class="token hvariable">avg</span><span class="token punctuation">)</span>
    <span class="token keyword">in</span>  <span class="token hvariable">makeVehicle</span> <span class="token hvariable">sense</span> <span class="token hvariable">decide</span> <span class="token hvariable">act</span> <span class="token hvariable">vehiclePicture</span>

<span class="token hvariable">vehicle3a</span> <span class="token operator">::</span> <span class="token constant">Vehicle</span>
<span class="token hvariable">vehicle3a</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">decide</span> <span class="token operator">=</span>  <span class="token hvariable">mapPair</span> <span class="token hvariable">inverse</span>
    <span class="token keyword">in</span>  <span class="token hvariable">makeVehicle</span> <span class="token hvariable">sense</span> <span class="token hvariable">decide</span> <span class="token hvariable">act</span> <span class="token hvariable">vehiclePicture</span>

<span class="token hvariable">vehicle3b</span> <span class="token operator">::</span> <span class="token constant">Vehicle</span>
<span class="token hvariable">vehicle3b</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">decide</span> <span class="token operator">=</span> <span class="token hvariable">swap</span><span class="token operator"> . </span><span class="token hvariable">mapPair</span> <span class="token hvariable">inverse</span>
    <span class="token keyword">in</span>  <span class="token hvariable">makeVehicle</span> <span class="token hvariable">sense</span> <span class="token hvariable">decide</span> <span class="token hvariable">act</span> <span class="token hvariable">vehiclePicture</span>
</code></pre>
<p>The vehicles vary only in their <code>decide</code> functions.</p>
<p>The <code>Vehicles.Vehicles</code> function keeps a list of the vehicles and their respective names, for the user to type into the console.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">allVehicles</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token constant">VehicleName</span><span class="token punctuation">,</span> <span class="token constant">Vehicle</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token hvariable">allVehicles</span> <span class="token operator">=</span>
    <span class="token punctuation">[</span> <span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token hvariable">vehicle1</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"2a"</span><span class="token punctuation">,</span> <span class="token hvariable">vehicle2a</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"2b"</span><span class="token punctuation">,</span> <span class="token hvariable">vehicle2b</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"2c"</span><span class="token punctuation">,</span> <span class="token hvariable">vehicle2c</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"3a"</span><span class="token punctuation">,</span> <span class="token hvariable">vehicle3a</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"3b"</span><span class="token punctuation">,</span> <span class="token hvariable">vehicle3b</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>
</code></pre>
<p>And finally we get to the <code>Main</code> module.</p>
<p>The <code>main</code> function is quite long, because it randomizes the states of each vehicle.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">main</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token builtin">mapM_</span> <span class="token builtin">putStrLn</span>
        <span class="token punctuation">[</span> <span class="token string">"Enter a vehicle."</span>
        <span class="token punctuation">,</span> <span class="token string">"You can also enter multiple vehicles separated by spaces."</span>
        <span class="token punctuation">,</span> <span class="token string">"The vehicles can be the same types."</span>
        <span class="token punctuation">,</span> <span class="token string">"Available vehicle types are: "</span> <span class="token operator">++</span> <span class="token builtin">unwords</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token builtin">fst</span> <span class="token hvariable">allVehicles</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>
    <span class="token hvariable">input</span> <span class="token operator">&lt;-</span> <span class="token builtin">words</span> <span class="token operator">&lt;$></span> <span class="token builtin">getLine</span>
    <span class="token keyword">case</span> <span class="token builtin">mapM</span> <span class="token hvariable">lookupVehicle</span> <span class="token hvariable">input</span> <span class="token keyword">of</span>
        <span class="token constant">Left</span> <span class="token hvariable">err</span> <span class="token operator">-></span> <span class="token builtin">putStrLn</span> <span class="token hvariable">err</span> <span class="token operator">>></span> <span class="token hvariable">main</span>
        <span class="token constant">Right</span> <span class="token hvariable">vehicles</span> <span class="token operator">-></span> <span class="token keyword">do</span>
            <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">w</span><span class="token punctuation">,</span> <span class="token hvariable">h</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span>
            <span class="token hvariable">initialState</span> <span class="token operator">&lt;-</span> <span class="token keyword">do</span>
                <span class="token keyword">let</span> <span class="token hvariable">randomize</span> <span class="token hvariable">vehicle</span> <span class="token operator">=</span> <span class="token keyword">do</span>
                        <span class="token keyword">let</span> <span class="token hvariable">randomAround</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">randomRIO</span> <span class="token punctuation">(</span><span class="token operator">-</span> <span class="token hvariable">x</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token hvariable">x</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
                        <span class="token hvariable">randX</span> <span class="token operator">&lt;-</span> <span class="token hvariable">randomAround</span> <span class="token operator">$</span> <span class="token builtin">fromIntegral</span> <span class="token hvariable">w</span> <span class="token operator">-</span> <span class="token number">100</span>
                        <span class="token hvariable">randY</span> <span class="token operator">&lt;-</span> <span class="token hvariable">randomAround</span> <span class="token operator">$</span> <span class="token builtin">fromIntegral</span> <span class="token hvariable">h</span> <span class="token operator">-</span> <span class="token number">100</span>
                        <span class="token keyword">let</span> <span class="token hvariable">location</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">randX</span><span class="token punctuation">,</span> <span class="token hvariable">randY</span><span class="token punctuation">)</span>
                        <span class="token hvariable">angle</span> <span class="token operator">&lt;-</span> <span class="token hvariable">randomRIO</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">359</span><span class="token punctuation">)</span>
                        <span class="token builtin">return</span> <span class="token operator">$</span> <span class="token hvariable">vehicle</span> <span class="token punctuation">{</span> <span class="token hvariable">state</span> <span class="token operator">=</span> <span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
                <span class="token hvariable">randomVehicles</span> <span class="token operator">&lt;-</span> <span class="token builtin">mapM</span> <span class="token hvariable">randomize</span> <span class="token hvariable">vehicles</span>
                <span class="token builtin">return</span> <span class="token operator">$</span> <span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">vehicles</span> <span class="token operator">=</span> <span class="token hvariable">randomVehicles</span><span class="token punctuation">,</span> <span class="token hvariable">mouse</span> <span class="token operator">=</span> <span class="token constant">Nothing</span> <span class="token punctuation">}</span>
            <span class="token builtin">mapM_</span> <span class="token builtin">putStrLn</span> 
                <span class="token punctuation">[</span> <span class="token string">"Instructions:"</span>
                <span class="token punctuation">,</span> <span class="token string">"Space bar: toggle mouse control"</span>
                <span class="token punctuation">,</span> <span class="token string">"Press enter to continue."</span> <span class="token punctuation">]</span>
            <span class="token hvariable">_</span> <span class="token operator">&lt;-</span> <span class="token builtin">getLine</span>
            <span class="token hvariable">play</span> <span class="token punctuation">(</span><span class="token constant">InWindow</span> <span class="token string">"Vehicles"</span> <span class="token punctuation">(</span><span class="token hvariable">w</span><span class="token punctuation">,</span> <span class="token hvariable">h</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token hvariable">white</span> <span class="token number">60</span> <span class="token hvariable">initialState</span> <span class="token hvariable">draw</span> <span class="token hvariable">handleInput</span> <span class="token hvariable">update</span>
</code></pre>
<p>Here are the other functions. They are quite simple to read.</p>
<pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">draw</span> <span class="token operator">::</span> <span class="token constant">State</span> <span class="token operator">-></span> <span class="token constant">Picture</span>
<span class="token hvariable">draw</span> <span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">vehicles</span><span class="token punctuation">,</span> <span class="token hvariable">mouse</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">mousePicture</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">mouse</span> <span class="token keyword">of</span>
            <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token hvariable">translate</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">$</span> <span class="token hvariable">circle</span> <span class="token hvariable">mouseCircleRadius</span>
            <span class="token constant">Nothing</span> <span class="token operator">-></span> <span class="token hvariable">blank</span>
        <span class="token hvariable">drawVehicle</span> <span class="token punctuation">(</span><span class="token constant">Vehicle</span> <span class="token punctuation">{</span> <span class="token hvariable">picture</span><span class="token punctuation">,</span> <span class="token hvariable">state</span> <span class="token operator">=</span> <span class="token constant">VehicleState</span> <span class="token punctuation">{</span> <span class="token hvariable">location</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">angle</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span>
            <span class="token hvariable">translate</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">$</span> <span class="token hvariable">rotate</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token hvariable">angle</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token hvariable">picture</span>
    <span class="token keyword">in</span>  <span class="token hvariable">pictures</span> <span class="token operator">$</span> <span class="token hvariable">mousePicture</span> <span class="token operator">:</span> <span class="token builtin">map</span> <span class="token hvariable">drawVehicle</span> <span class="token hvariable">vehicles</span>

<span class="token hvariable">update</span> <span class="token operator">::</span> <span class="token constant">TimePassed</span> <span class="token operator">-></span> <span class="token constant">State</span> <span class="token operator">-></span> <span class="token constant">State</span>
<span class="token hvariable">update</span> <span class="token hvariable">_</span> <span class="token hvariable">state</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">mouse</span> <span class="token operator">=</span> <span class="token constant">Nothing</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">state</span>
<span class="token hvariable">update</span> <span class="token hvariable">time</span> <span class="token hvariable">state</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">mouse</span> <span class="token operator">=</span> <span class="token constant">Just</span> <span class="token hvariable">sourceLoc</span><span class="token punctuation">,</span> <span class="token hvariable">vehicles</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">updateVehicle</span> <span class="token hvariable">vehicle</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">Vehicle</span> <span class="token punctuation">{</span> <span class="token hvariable">function</span><span class="token punctuation">,</span> <span class="token hvariable">state</span> <span class="token operator">=</span> <span class="token hvariable">vState</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span>
            <span class="token hvariable">vehicle</span> <span class="token punctuation">{</span> <span class="token hvariable">state</span> <span class="token operator">=</span> <span class="token hvariable">function</span> <span class="token hvariable">sourceLoc</span> <span class="token hvariable">time</span> <span class="token hvariable">vState</span> <span class="token punctuation">}</span>
    <span class="token keyword">in</span>  <span class="token hvariable">state</span> <span class="token punctuation">{</span> <span class="token hvariable">vehicles</span> <span class="token operator">=</span> <span class="token builtin">map</span> <span class="token hvariable">updateVehicle</span> <span class="token hvariable">vehicles</span> <span class="token punctuation">}</span>

<span class="token hvariable">handleInput</span> <span class="token operator">::</span> <span class="token constant">Event</span> <span class="token operator">-></span> <span class="token constant">State</span> <span class="token operator">-></span> <span class="token constant">State</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventKey</span> <span class="token punctuation">(</span><span class="token constant">SpecialKey</span> <span class="token constant">KeySpace</span><span class="token punctuation">)</span> <span class="token constant">Down</span> <span class="token hvariable">_</span> <span class="token hvariable">pos</span><span class="token punctuation">)</span> <span class="token hvariable">state</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">mouse</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">case</span> <span class="token hvariable">mouse</span> <span class="token keyword">of</span>
        <span class="token constant">Nothing</span> <span class="token operator">-></span> <span class="token hvariable">state</span> <span class="token punctuation">{</span> <span class="token hvariable">mouse</span> <span class="token operator">=</span> <span class="token constant">Just</span> <span class="token hvariable">pos</span> <span class="token punctuation">}</span>
        <span class="token constant">Just</span> <span class="token hvariable">_</span> <span class="token operator">-></span> <span class="token hvariable">state</span> <span class="token punctuation">{</span> <span class="token hvariable">mouse</span> <span class="token operator">=</span> <span class="token constant">Nothing</span> <span class="token punctuation">}</span>
<span class="token hvariable">handleInput</span> <span class="token punctuation">(</span><span class="token constant">EventMotion</span> <span class="token hvariable">pos</span><span class="token punctuation">)</span> <span class="token hvariable">state</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">State</span> <span class="token punctuation">{</span> <span class="token hvariable">mouse</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">case</span> <span class="token hvariable">mouse</span> <span class="token keyword">of</span>
        <span class="token constant">Nothing</span> <span class="token operator">-></span> <span class="token hvariable">state</span>
        <span class="token constant">Just</span> <span class="token hvariable">_</span> <span class="token operator">-></span> <span class="token hvariable">state</span> <span class="token punctuation">{</span> <span class="token hvariable">mouse</span> <span class="token operator">=</span> <span class="token constant">Just</span> <span class="token hvariable">pos</span> <span class="token punctuation">}</span>
<span class="token hvariable">handleInput</span> <span class="token hvariable">_</span> <span class="token hvariable">state</span> <span class="token operator">=</span> <span class="token hvariable">state</span>
</code></pre>
<p>An important factor when I designed this structure for the code was extensibility. New vehicles can be easily added on, simply by defining the <code>sense</code>, <code>decide</code>, and <code>act</code> functions, and a picture. Or it only needs to define <code>decide</code> if it uses modules like <code>Vehicles.TwoWheeled</code>. Then, the vehicle needs to be included with its name in <code>allVehicles</code>.</p>
<p>One problem I faced was that vehicle 3a, which is supposed to go towards a source, and stay at the source, slowed down, but then went past the source. This was due to the steps being discrete, instead of ideally being continuous, even though it is running at 60 steps per second. The vehicle advanced step by step, and eventually, even though the steps were getting smaller, still stepped over the source, then sped up again.</p>
<p>I solved this by forcing the vehicle to stay in the same place if it is really close to the source and the distance that it traveled was very small. It is in the <code>makeVehicle</code> function above.</p>
<p>I actually added support for adding multiple sources last night, like a source is created when you click somewhere, but it didn&#39;t work and I didn&#39;t want to debug it because I was really tired last night and it was past midnight, so I just reverted the code.</p>
<p>Some future improvements I could make are to add support for multiple sources, and add vehicle 4a and 4b.</p>
<p>Braitenberg vehicles are very interesting. I like how they move differently according to different rules. I want to read Braitenberg&#39;s complete book one day.</p>
